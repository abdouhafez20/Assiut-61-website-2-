<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ÙØ±ÙŠÙ… Ø¯ÙØ¹Ø© 61 Ø·Ø¨ Ø£Ø³ÙŠÙˆØ· ğŸ“</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

    body {
      font-family: 'Cairo', sans-serif;
      background-color: #121212;
      color: #fff;
      text-align: center;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
      color: #f2f2f2;
    }

    input[type="file"], button {
      padding: 12px 18px;
      margin: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    input[type="file"] {
      background-color: #1e1e1e;
      color: #f2f2f2;
    }

    button {
      background-color: #5ea1f0;
      color: white;
    }

    button:hover {
      background-color: #388be0;
    }

    canvas {
      display: block;
      margin: 20px auto;
      max-width: 100%;
      border-radius: 12px;
    }

    #successMsg {
      font-size: 18px;
      color: #90ee90;
      margin-top: 10px;
    }

    #spinner {
      display: none;
      margin-top: 20px;
    }

    #spinner:after {
      content: "";
      width: 40px;
      height: 40px;
      border: 4px solid #fff;
      border-top: 4px solid #5ea1f0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #aaa;
    }

    footer a {
      color: #5ea1f0;
      text-decoration: none;
    }

    @media (max-width: 600px) {
      button, input[type="file"] {
        width: 90%;
        font-size: 16px;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸ“ Ø£Ø¶Ù ÙØ±ÙŠÙ… Ø¯ÙØ¹Ø© 61 Ø¹Ù„Ù‰ ØµÙˆØ±ØªÙƒ</h1>
  <input type="file" id="photoInput" accept="image/*" capture="environment">
  <button id="downloadBtn" style="display:none;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
  <div id="spinner"></div>
  <canvas id="canvas" width="1080" height="1350"></canvas>
  <p id="successMsg"></p>

  <footer>
    <p>ğŸ“ <a href="https://t.me/Assiut61framebot" target="_blank">Ø¨ÙˆØª Ø§Ù„ÙØ±ÙŠÙ… Ø¹Ù„Ù‰ Telegram</a> |
      ğŸ›  <a href="https://t.me/abdomahmood" target="_blank">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a>
    </p>
    <p>Designed by Abdurrahman Mahmoud</p>
  </footer>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const photoInput = document.getElementById('photoInput');
    const downloadBtn = document.getElementById('downloadBtn');
    const successMsg = document.getElementById('successMsg');
    const spinner = document.getElementById('spinner');

    let imgData = { img: null, x: 0, y: 0, scale: 1 };
    const frame = new Image();
    frame.src = 'frame.png';

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (imgData.img) {
        ctx.drawImage(
          imgData.img,
          imgData.x,
          imgData.y,
          imgData.img.width * imgData.scale,
          imgData.img.height * imgData.scale
        );
      }
      if (frame.complete) {
        ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
      }
      // Save state
      localStorage.setItem('frameAdjustments', JSON.stringify({
        x: imgData.x,
        y: imgData.y,
        scale: imgData.scale
      }));
    }

    function flashPreview() {
      canvas.style.transition = 'box-shadow 0.3s ease';
      canvas.style.boxShadow = '0 0 20px #5ea1f0';
      setTimeout(() => canvas.style.boxShadow = 'none', 400);
    }

    photoInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        const img = new Image();
        img.onload = () => {
          imgData.img = img;
          imgData.scale = Math.min(canvas.width / img.width, canvas.height / img.height);
          imgData.x = (canvas.width - img.width * imgData.scale) / 2;
          imgData.y = (canvas.height - img.height * imgData.scale) / 2;

          // Restore position if exists
          const saved = localStorage.getItem('frameAdjustments');
          if (saved) {
            const { x, y, scale } = JSON.parse(saved);
            imgData.x = x;
            imgData.y = y;
            imgData.scale = scale;
          }

          draw();
          flashPreview();
          downloadBtn.style.display = 'inline-block';
          successMsg.textContent = '';
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    downloadBtn.addEventListener('click', () => {
      spinner.style.display = 'inline-block';
      setTimeout(() => {
        draw(); // Make sure it's updated
        canvas.toBlob(blob => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'graduation-frame.png';
          a.click();

          successMsg.textContent = 'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!';
          spinner.style.display = 'none';

          // Web Share API
          if (navigator.canShare && navigator.canShare({ files: [blob] })) {
            const shareBtn = document.createElement('button');
            shareBtn.textContent = 'ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø©';
            shareBtn.style.marginTop = '10px';
            shareBtn.onclick = () => {
              navigator.share({
                files: [blob],
                title: 'ØµÙˆØ±ØªÙŠ Ù…Ø¹ ÙØ±ÙŠÙ… Ø¯ÙØ¹Ø© 61',
                text: 'Ø¬Ø±Ø¨ Ø£Ù†Øª ÙƒÙ…Ø§Ù† Ù…Ù† Ù‡Ù†Ø§ ğŸ“',
                url: window.location.href
              });
            };
            document.body.appendChild(shareBtn);
          }

        }, 'image/png');
      }, 300);
    });

    // Touch zoom + drag
    let lastTouchDist = null;
    let lastX = null;
    let lastY = null;

    canvas.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        lastTouchDist = Math.sqrt(dx * dx + dy * dy);
      } else if (e.touches.length === 1) {
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      }
    });

    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!imgData.img) return;

      if (e.touches.length === 2 && lastTouchDist !== null) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const newDist = Math.sqrt(dx * dx + dy * dy);
        const deltaScale = newDist / lastTouchDist;
        imgData.scale *= deltaScale;
        imgData.scale = Math.max(0.2, Math.min(3, imgData.scale));
        lastTouchDist = newDist;
      } else if (e.touches.length === 1 && lastX !== null && lastY !== null) {
        const dx = e.touches[0].clientX - lastX;
        const dy = e.touches[0].clientY - lastY;
        imgData.x += dx;
        imgData.y += dy;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      }
      draw();
    }, { passive: false });

    // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ…
    frame.onerror = () => {
      setTimeout(() => {
        frame.src = 'frame.png';
      }, 1000);
    };
  </script>
</body>
</html>